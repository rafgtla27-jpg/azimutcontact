<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Map | AzimutTrans</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #FF6B35;
            --primary-hover: #E85A2A;
            --secondary: #004E89;
            --accent: #FFD23F;
            --bg: #0A0E27;
            --sidebar-bg: #141937;
            --card-bg: #1E2749;
            --card-hover: #252E5C;
            --text: #F4F6FB;
            --text-muted: #8B94BC;
            --border: #2A3458;
            --success: #00D9A3;
            --danger: #FF4757;
            --warning: #FFD23F;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOGIN
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #0A0E27 0%, #1E2749 100%);
            z-index: 3000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .login-box {
            background: var(--sidebar-bg);
            padding: 56px 48px;
            border-radius: 24px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 40px 80px rgba(0,0,0,0.6);
            border: 2px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        .login-box::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            z-index: -1;
            opacity: 0.1;
            border-radius: 24px;
        }
        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        .login-logo span {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Space Mono', monospace;
            letter-spacing: -0.02em;
        }
        .login-logo p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-top: 8px;
            font-weight: 300;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LAYOUT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #main-content {
            display: none;
            width: 100%;
            height: 100vh;
            flex-direction: row;
        }
        #main-content.visible { display: flex !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SIDEBAR
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #sidebar {
            width: 340px;
            min-width: 340px;
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }
        #sidebar::-webkit-scrollbar { width: 6px; }
        #sidebar::-webkit-scrollbar-track { background: transparent; }
        #sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .sidebar-header {
            padding: 28px 24px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(180deg, var(--sidebar-bg) 0%, #0f1430 100%);
            position: sticky;
            top: 0;
            z-index: 5;
        }
        .sidebar-header h1 {
            font-size: 1.4rem;
            font-weight: 800;
            margin: 0 0 6px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Space Mono', monospace;
            letter-spacing: -0.02em;
        }
        .sidebar-header p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 300;
        }

        .sidebar-section {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }
        .sidebar-section-title {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin: 0 0 14px;
            font-family: 'Space Mono', monospace;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAP
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #map {
            flex: 1;
            height: 100vh;
            min-width: 0;
            position: relative;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CONTACT LIST
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #contact-list {
            width: 380px;
            min-width: 380px;
            height: 100vh;
            background: var(--sidebar-bg);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .contact-list-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(180deg, var(--sidebar-bg) 0%, #0f1430 100%);
            flex-shrink: 0;
        }
        #contacts-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }
        #contacts-scroll::-webkit-scrollbar { width: 6px; }
        #contacts-scroll::-webkit-scrollbar-track { background: transparent; }
        #contacts-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STATS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .contact-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        .stat-card {
            background: var(--card-bg);
            padding: 16px 18px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255,107,53,0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }
        .stat-card:hover::before { opacity: 1; }
        .stat-value {
            display: block;
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Space Mono', monospace;
        }
        .stat-label {
            display: block;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FILTERS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .search-wrapper {
            position: relative;
            margin-bottom: 16px;
        }
        .search-wrapper svg {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            stroke: var(--text-muted);
        }
        #search-input {
            width: 100%;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--text);
            font-size: 0.9rem;
            padding: 14px 16px 14px 44px;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
        }
        #search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
        }
        #search-input::placeholder { color: var(--text-muted); }

        .filter-section {
            margin-bottom: 20px;
        }
        .filter-section-title {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 10px;
            font-family: 'Space Mono', monospace;
        }
        .filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .filter-tag {
            background: var(--card-bg);
            border: 2px solid var(--border);
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-tag:hover {
            background: var(--card-hover);
            transform: translateY(-2px);
        }
        .filter-tag.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: var(--bg);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }
        .filter-tag .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CONTACT CARD
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .contact-card {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 14px;
            padding: 16px 18px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .contact-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .contact-card:hover {
            background: var(--card-hover);
            transform: translateX(4px);
            border-color: var(--primary);
        }
        .contact-card:hover::before { opacity: 1; }
        .contact-name {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .contact-company {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0 0 8px;
            font-weight: 500;
        }
        .contact-location {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .company-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            flex-shrink: 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BUTTONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn {
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            border: 2px solid;
            transition: all 0.3s;
            text-align: center;
            font-family: 'Outfit', sans-serif;
            letter-spacing: 0.02em;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF8F5D);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 4px 16px rgba(255, 107, 53, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(255, 107, 53, 0.5);
        }
        .btn-outline {
            background: transparent;
            color: var(--text);
            border-color: var(--border);
        }
        .btn-outline:hover {
            background: var(--card-bg);
            border-color: var(--primary);
        }
        .btn-danger {
            background: var(--danger);
            color: #fff;
            border-color: transparent;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 14, 39, 0.85);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--sidebar-bg);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            max-width: 650px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal h2 {
            font-size: 1.5rem;
            margin: 0 0 24px;
            color: var(--text);
            font-weight: 800;
        }
        .form-group { margin-bottom: 18px; }
        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-family: 'Space Mono', monospace;
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-family: 'Outfit', sans-serif;
            outline: none;
            transition: all 0.3s;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
        }
        .form-textarea { min-height: 80px; resize: vertical; }
        .form-checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ZONE SELECTOR
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .zone-selector {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .zone-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
        }
        .zone-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-muted);
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }
        .zone-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: transparent;
            color: var(--bg);
        }
        .zone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
            gap: 8px;
            max-height: 220px;
            overflow-y: auto;
            padding: 4px;
        }
        .zone-item {
            padding: 10px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }
        .zone-item:hover {
            background: var(--card-hover);
            transform: scale(1.05);
        }
        .zone-item.selected {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: transparent;
            color: var(--bg);
        }
        .selected-zones-display {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            font-size: 0.75rem;
            min-height: 40px;
            color: var(--text-muted);
        }
        .selected-zone-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            margin: 3px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NO LOCATION SECTION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .no-location-section {
            background: var(--card-bg);
            border: 2px solid var(--warning);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .no-location-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            cursor: pointer;
        }
        .no-location-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--warning);
        }
        .no-location-count {
            background: rgba(255, 210, 63, 0.2);
            color: var(--warning);
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 800;
            font-family: 'Space Mono', monospace;
        }
        .no-location-list {
            display: none;
            margin-top: 12px;
        }
        .no-location-list.expanded { display: block; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAP CONTROLS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .map-control-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 14px 18px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            transition: all 0.3s;
            font-size: 0.8rem;
            font-weight: 700;
            color: #333;
            font-family: 'Outfit', sans-serif;
        }
        .map-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(0,0,0,0.3);
        }
        .map-control-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CUSTOM MARKERS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .custom-marker {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
            cursor: pointer;
        }
        .custom-marker:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
        }

        /* Cluster styling */
        .marker-cluster {
            background: rgba(255, 107, 53, 0.6);
            border: 3px solid var(--primary);
        }
        .marker-cluster div {
            background: var(--primary);
            color: white;
            font-weight: 800;
            font-family: 'Space Mono', monospace;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           POPUP
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .leaflet-popup-content-wrapper {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 14px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            padding: 0;
        }
        .leaflet-popup-content {
            margin: 0;
            font-family: 'Outfit', sans-serif;
        }
        .popup-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .popup-title {
            font-weight: 800;
            font-size: 1rem;
            color: var(--text);
            margin-bottom: 4px;
        }
        .popup-company {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .popup-body {
            padding: 16px;
            color: var(--text);
            font-size: 0.8rem;
        }
        .popup-contact-item {
            padding: 10px;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .popup-contact-item:hover {
            background: var(--card-hover);
            transform: translateX(4px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOAST
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .toast {
            position: fixed;
            bottom: 28px;
            right: 28px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 14px;
            padding: 16px 24px;
            min-width: 300px;
            box-shadow: 0 12px 48px rgba(0,0,0,0.5);
            z-index: 9999;
            transform: translateX(450px);
            transition: transform 0.4s ease;
            font-weight: 600;
        }
        .toast.show { transform: translateX(0); }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BACK TO TOP
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #back-top-btn {
            position: fixed;
            bottom: 28px;
            left: 360px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(255, 107, 53, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s;
            pointer-events: none;
            font-size: 1.5rem;
            font-weight: 800;
        }
        #back-top-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        #back-top-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.7);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ANIMATIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .contact-card, .stat-card {
            animation: fadeIn 0.4s ease forwards;
        }

        /* GeoJSON Layer styles */
        .geojson-region {
            fill-opacity: 0.15;
            stroke-width: 2;
            stroke-opacity: 0.5;
        }
        .geojson-department {
            fill-opacity: 0.1;
            stroke-width: 1;
            stroke-opacity: 0.3;
        }
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-overlay">
    <div class="login-box">
        <div class="login-logo">
            <span>AZIMUT</span>
            <p>Contact Management System</p>
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" id="password-input" class="form-input" placeholder="Enter password" onkeypress="if(event.key==='Enter') checkPassword()">
        </div>
        <button class="btn btn-primary" style="width:100%;" onclick="checkPassword()">Login</button>
        <div id="login-error" style="color:var(--danger);font-size:0.85rem;margin-top:12px;display:none;font-weight:600;">Incorrect password</div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN CONTENT
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="main-content">
    <!-- SIDEBAR -->
    <div id="sidebar">
        <div class="sidebar-header">
            <h1>AZIMUT</h1>
            <p>Contact Management</p>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Actions</div>
            <button class="btn btn-primary" style="width:100%;margin-bottom:10px;" onclick="openContactModal()">+ New Contact</button>
            <button class="btn btn-outline" style="width:100%;margin-bottom:10px;" onclick="document.getElementById('excel-input').click()">ğŸ“¥ Import Excel</button>
            <input type="file" id="excel-input" accept=".xlsx,.xls" style="display:none;" onchange="importExcel(this)">
            <button class="btn btn-outline" style="width:100%;" onclick="exportExcel()">ğŸ“¤ Export Excel</button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Statistics</div>
            <div class="contact-stats">
                <div class="stat-card">
                    <span class="stat-value" id="stat-total">0</span>
                    <span class="stat-label">TOTAL</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-regional">0</span>
                    <span class="stat-label">REGIONAL</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-national">0</span>
                    <span class="stat-label">NATIONAL</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-no-location">0</span>
                    <span class="stat-label">ALL FRANCE</span>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Filters</div>
            
            <div class="filter-section">
                <div class="filter-section-title">Company</div>
                <div class="filters" id="filters-company"></div>
            </div>

            <div class="filter-section">
                <div class="filter-section-title">Region</div>
                <div class="filters" id="filters-region"></div>
            </div>

            <div class="filter-section">
                <div class="filter-section-title">City</div>
                <div class="filters" id="filters-city"></div>
            </div>

            <div class="filter-section">
                <div class="filter-section-title">Scope</div>
                <div class="filters" id="filters-scope"></div>
            </div>
        </div>
    </div>

    <!-- MAP -->
    <div id="map"></div>

    <!-- Map Controls -->
    <div class="map-controls">
        <button class="map-control-btn" id="toggle-departments" onclick="toggleDepartments()">
            ğŸ“ Departments
        </button>
        <button class="map-control-btn" id="toggle-regions" onclick="toggleRegions()">
            ğŸ—ºï¸ Regions
        </button>
    </div>

    <!-- CONTACT LIST -->
    <div id="contact-list">
        <div class="contact-list-header">
            <div class="search-wrapper">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <input type="text" id="search-input" placeholder="Search contacts..." oninput="applyFilters()">
            </div>
        </div>
        <div id="contacts-scroll"></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CONTACT MODAL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="contact-modal">
    <div class="modal">
        <h2 id="modal-title">New Contact</h2>
        <form id="contact-form" onsubmit="saveContact(event)">
            <div class="form-group">
                <label class="form-label">First Name *</label>
                <input type="text" id="edit-firstName" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">Last Name</label>
                <input type="text" id="edit-lastName" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Company</label>
                <input type="text" id="edit-company" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="edit-email" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="tel" id="edit-phone" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">City</label>
                <input type="text" id="edit-city" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Region</label>
                <input type="text" id="edit-region" class="form-input">
            </div>
            
            <div class="form-group">
                <label class="form-label">Delivery Zones</label>
                <div class="zone-selector">
                    <div class="zone-tabs">
                        <button type="button" class="zone-tab active" onclick="switchZoneTab('departments')">Departments</button>
                        <button type="button" class="zone-tab" onclick="switchZoneTab('regions')">Regions</button>
                    </div>
                    <div class="zone-grid" id="zone-departments"></div>
                    <div class="zone-grid" id="zone-regions" style="display:none;"></div>
                    <div class="selected-zones-display" id="selected-zones-display">
                        No zones selected
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Scope</label>
                <div class="form-checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-scopeRegional">
                        <span>Regional</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-scopeNational">
                        <span>National</span>
                    </label>
                </div>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn btn-primary" style="flex:1;">Save</button>
                <button type="button" class="btn btn-outline" style="flex:1;" onclick="closeContactModal()">Cancel</button>
                <button type="button" class="btn btn-danger" id="delete-btn" style="display:none;" onclick="deleteContact()">Delete</button>
            </div>
        </form>
    </div>
</div>

<button id="back-top-btn" onclick="scrollToTop()">â†‘</button>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPTS
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL VARIABLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CORRECT_PASSWORD = 'azimut2025';
let contacts = [];
let map, markerClusterGroup;
let departmentLayer = null;
let regionLayer = null;
let showDepartments = false;
let showRegions = false;
let currentEditingId = null;
let selectedZones = { departments: [], regions: [] };
let currentZoneTab = 'departments';
let companyColors = {};

// DÃ©partements franÃ§ais
const DEPARTMENTS = [
    '01', '02', '03', '04', '05', '06', '07', '08', '09', '10',
    '11', '12', '13', '14', '15', '16', '17', '18', '19', '21',
    '22', '23', '24', '25', '26', '27', '28', '29', '2A', '2B',
    '30', '31', '32', '33', '34', '35', '36', '37', '38', '39',
    '40', '41', '42', '43', '44', '45', '46', '47', '48', '49',
    '50', '51', '52', '53', '54', '55', '56', '57', '58', '59',
    '60', '61', '62', '63', '64', '65', '66', '67', '68', '69',
    '70', '71', '72', '73', '74', '75', '76', '77', '78', '79',
    '80', '81', '82', '83', '84', '85', '86', '87', '88', '89',
    '90', '91', '92', '93', '94', '95'
];

// RÃ©gions franÃ§aises
const REGIONS = [
    'Auvergne-RhÃ´ne-Alpes',
    'Bourgogne-Franche-ComtÃ©',
    'Bretagne',
    'Centre-Val de Loire',
    'Corse',
    'Grand Est',
    'Hauts-de-France',
    'Ãle-de-France',
    'Normandie',
    'Nouvelle-Aquitaine',
    'Occitanie',
    'Pays de la Loire',
    'Provence-Alpes-CÃ´te d\'Azur'
];

// Color palette for companies
const COLOR_PALETTE = [
    '#FF6B35', '#004E89', '#FFD23F', '#00D9A3', '#FF4757',
    '#9B59B6', '#3498DB', '#E74C3C', '#1ABC9C', '#F39C12',
    '#D35400', '#8E44AD', '#2980B9', '#27AE60', '#C0392B',
    '#16A085', '#2C3E50', '#F1C40F', '#E67E22', '#95A5A6'
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COLOR MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getCompanyColor(company) {
    if (!company) return COLOR_PALETTE[0];
    if (!companyColors[company]) {
        const usedColors = Object.values(companyColors);
        const availableColors = COLOR_PALETTE.filter(c => !usedColors.includes(c));
        companyColors[company] = availableColors.length > 0 
            ? availableColors[0] 
            : COLOR_PALETTE[Object.keys(companyColors).length % COLOR_PALETTE.length];
    }
    return companyColors[company];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkPassword() {
    const input = document.getElementById('password-input').value;
    const error = document.getElementById('login-error');
    if (input === CORRECT_PASSWORD) {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('main-content').classList.add('visible');
        init();
    } else {
        error.style.display = 'block';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
    initMap();
    initZoneSelector();
    await loadFromServer();
    refreshUI();
    initBackToTopBtn();
}

function initMap() {
    map = L.map('map').setView([46.603354, 1.888334], 6);
    
    // Dark theme tiles
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© OpenStreetMap, Â© CartoDB',
        maxZoom: 19
    }).addTo(map);

    markerClusterGroup = L.markerClusterGroup({
        maxClusterRadius: 60,
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        iconCreateFunction: function(cluster) {
            const count = cluster.getChildCount();
            return L.divIcon({
                html: `<div><span>${count}</span></div>`,
                className: 'marker-cluster',
                iconSize: L.point(40, 40)
            });
        }
    });
    map.addLayer(markerClusterGroup);
}

function initZoneSelector() {
    const deptGrid = document.getElementById('zone-departments');
    DEPARTMENTS.forEach(dept => {
        const item = document.createElement('div');
        item.className = 'zone-item';
        item.textContent = dept;
        item.onclick = () => toggleZone('departments', dept, item);
        deptGrid.appendChild(item);
    });

    const regionGrid = document.getElementById('zone-regions');
    REGIONS.forEach(region => {
        const item = document.createElement('div');
        item.className = 'zone-item';
        item.textContent = region.length > 15 ? region.substring(0, 13) + '...' : region;
        item.title = region;
        item.onclick = () => toggleZone('regions', region, item);
        regionGrid.appendChild(item);
    });
}

function switchZoneTab(tab) {
    currentZoneTab = tab;
    document.querySelectorAll('.zone-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('zone-departments').style.display = tab === 'departments' ? 'grid' : 'none';
    document.getElementById('zone-regions').style.display = tab === 'regions' ? 'grid' : 'none';
}

function toggleZone(type, zone, element) {
    const index = selectedZones[type].indexOf(zone);
    if (index > -1) {
        selectedZones[type].splice(index, 1);
        element.classList.remove('selected');
    } else {
        selectedZones[type].push(zone);
        element.classList.add('selected');
    }
    updateSelectedZonesDisplay();
}

function updateSelectedZonesDisplay() {
    const display = document.getElementById('selected-zones-display');
    const allZones = [
        ...selectedZones.departments.map(d => `Dept ${d}`),
        ...selectedZones.regions
    ];
    
    if (allZones.length === 0) {
        display.innerHTML = 'No zones selected';
    } else {
        display.innerHTML = allZones.map(z => `<span class="selected-zone-tag">${z}</span>`).join('');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP ZONES (GeoJSON)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function toggleDepartments() {
    showDepartments = !showDepartments;
    document.getElementById('toggle-departments').classList.toggle('active', showDepartments);
    
    if (showDepartments) {
        if (!departmentLayer) {
            try {
                // Load French departments GeoJSON from external source
                const response = await fetch('https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/departements.geojson');
                const geojson = await response.json();
                
                departmentLayer = L.geoJSON(geojson, {
                    style: {
                        color: '#FFD23F',
                        weight: 1,
                        opacity: 0.5,
                        fillColor: '#FFD23F',
                        fillOpacity: 0.1
                    },
                    className: 'geojson-department',
                    onEachFeature: (feature, layer) => {
                        layer.bindPopup(`<strong>DÃ©partement ${feature.properties.code}</strong><br>${feature.properties.nom}`);
                    }
                }).addTo(map);
                
                toast('ğŸ“ Departments displayed');
            } catch (err) {
                console.error('Error loading departments:', err);
                toast('Error loading departments', 'error');
                showDepartments = false;
                document.getElementById('toggle-departments').classList.remove('active');
            }
        } else {
            map.addLayer(departmentLayer);
        }
    } else {
        if (departmentLayer) {
            map.removeLayer(departmentLayer);
        }
    }
}

async function toggleRegions() {
    showRegions = !showRegions;
    document.getElementById('toggle-regions').classList.toggle('active', showRegions);
    
    if (showRegions) {
        if (!regionLayer) {
            try {
                // Load French regions GeoJSON from external source
                const response = await fetch('https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/regions.geojson');
                const geojson = await response.json();
                
                regionLayer = L.geoJSON(geojson, {
                    style: {
                        color: '#FF6B35',
                        weight: 2,
                        opacity: 0.6,
                        fillColor: '#FF6B35',
                        fillOpacity: 0.15
                    },
                    className: 'geojson-region',
                    onEachFeature: (feature, layer) => {
                        layer.bindPopup(`<strong>RÃ©gion</strong><br>${feature.properties.nom}`);
                    }
                }).addTo(map);
                
                toast('ğŸ—ºï¸ Regions displayed');
            } catch (err) {
                console.error('Error loading regions:', err);
                toast('Error loading regions', 'error');
                showRegions = false;
                document.getElementById('toggle-regions').classList.remove('active');
            }
        } else {
            map.addLayer(regionLayer);
        }
    } else {
        if (regionLayer) {
            map.removeLayer(regionLayer);
        }
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTACT MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openContactModal(contactId = null) {
    currentEditingId = contactId;
    const modal = document.getElementById('contact-modal');
    const title = document.getElementById('modal-title');
    const deleteBtn = document.getElementById('delete-btn');
    
    selectedZones = { departments: [], regions: [] };
    document.querySelectorAll('.zone-item').forEach(item => item.classList.remove('selected'));
    updateSelectedZonesDisplay();

    if (contactId) {
        const contact = contacts.find(c => c.id === contactId);
        if (contact) {
            title.textContent = 'Edit Contact';
            document.getElementById('edit-firstName').value = contact.firstName || '';
            document.getElementById('edit-lastName').value = contact.lastName || '';
            document.getElementById('edit-company').value = contact.company || '';
            document.getElementById('edit-email').value = contact.email || '';
            document.getElementById('edit-phone').value = contact.phone || '';
            document.getElementById('edit-city').value = contact.city || '';
            document.getElementById('edit-region').value = contact.region || '';
            document.getElementById('edit-scopeRegional').checked = contact.scopeRegional || false;
            document.getElementById('edit-scopeNational').checked = contact.scopeNational || false;
            
            if (contact.deliveryZones) {
                selectedZones = JSON.parse(JSON.stringify(contact.deliveryZones));
                selectedZones.departments.forEach(dept => {
                    const item = Array.from(document.querySelectorAll('#zone-departments .zone-item'))
                        .find(el => el.textContent === dept);
                    if (item) item.classList.add('selected');
                });
                selectedZones.regions.forEach(region => {
                    const item = Array.from(document.querySelectorAll('#zone-regions .zone-item'))
                        .find(el => el.title === region || el.textContent === region);
                    if (item) item.classList.add('selected');
                });
                updateSelectedZonesDisplay();
            }
            
            deleteBtn.style.display = 'block';
        }
    } else {
        title.textContent = 'New Contact';
        document.getElementById('contact-form').reset();
        deleteBtn.style.display = 'none';
    }
    
    modal.classList.add('active');
}

function closeContactModal() {
    document.getElementById('contact-modal').classList.remove('active');
    currentEditingId = null;
}

async function saveContact(event) {
    event.preventDefault();
    
    const firstName = document.getElementById('edit-firstName').value.trim();
    const lastName = document.getElementById('edit-lastName').value.trim();
    const company = document.getElementById('edit-company').value.trim();
    const email = document.getElementById('edit-email').value.trim();
    const phone = document.getElementById('edit-phone').value.trim();
    const city = document.getElementById('edit-city').value.trim();
    const region = document.getElementById('edit-region').value.trim();
    const scopeRegional = document.getElementById('edit-scopeRegional').checked;
    const scopeNational = document.getElementById('edit-scopeNational').checked;

    let lat = null, lon = null, fullName = '';
    
    if (city) {
        const coords = await geocode(city);
        if (coords) {
            lat = coords.lat;
            lon = coords.lon;
            fullName = coords.fullName;
        }
    }

    const contactData = {
        firstName, lastName, company, email, phone, city, region,
        scopeRegional, scopeNational, lat, lon, fullName,
        deliveryZones: { ...selectedZones }
    };

    if (currentEditingId) {
        const index = contacts.findIndex(c => c.id === currentEditingId);
        if (index > -1) {
            contacts[index] = { ...contacts[index], ...contactData };
        }
    } else {
        contacts.push({
            id: Date.now().toString() + Math.random(),
            ...contactData
        });
    }

    await saveToServer();
    refreshUI();
    closeContactModal();
    toast(currentEditingId ? 'âœ… Contact updated' : 'âœ… Contact created');
}

function deleteContact() {
    if (!currentEditingId) return;
    if (!confirm('Delete this contact?')) return;
    
    contacts = contacts.filter(c => c.id !== currentEditingId);
    saveToServer();
    refreshUI();
    closeContactModal();
    toast('ğŸ—‘ï¸ Contact deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI REFRESH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function refreshUI() {
    updateStats();
    updateFilters();
    applyFilters();
}

function updateStats() {
    const regional = contacts.filter(c => c.scopeRegional).length;
    const national = contacts.filter(c => c.scopeNational).length;
    const noLocation = contacts.filter(c => !c.lat && !c.lon).length;
    
    document.getElementById('stat-total').textContent = contacts.length;
    document.getElementById('stat-regional').textContent = regional;
    document.getElementById('stat-national').textContent = national;
    document.getElementById('stat-no-location').textContent = noLocation;
}

function updateFilters() {
    // Company filters
    const companies = [...new Set(contacts.map(c => c.company).filter(Boolean))].sort();
    const companyContainer = document.getElementById('filters-company');
    companyContainer.innerHTML = `<div class="filter-tag active" data-type="company" data-value="all">All</div>` +
        companies.map(c => {
            const color = getCompanyColor(c);
            return `<div class="filter-tag" data-type="company" data-value="${c}">
                <span class="color-dot" style="background:${color}"></span>
                ${c}
            </div>`;
        }).join('');

    // Region filters
    const regions = [...new Set(contacts.map(c => c.region).filter(Boolean))].sort();
    const regionContainer = document.getElementById('filters-region');
    regionContainer.innerHTML = `<div class="filter-tag active" data-type="region" data-value="all">All</div>` +
        regions.map(r => `<div class="filter-tag" data-type="region" data-value="${r}">${r}</div>`).join('');

    // City filters (top 10)
    const cityCount = {};
    contacts.forEach(c => {
        if (c.city) {
            cityCount[c.city] = (cityCount[c.city] || 0) + 1;
        }
    });
    const topCities = Object.entries(cityCount)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)
        .map(([city]) => city);
    const cityContainer = document.getElementById('filters-city');
    cityContainer.innerHTML = `<div class="filter-tag active" data-type="city" data-value="all">All</div>` +
        topCities.map(c => `<div class="filter-tag" data-type="city" data-value="${c}">${c}</div>`).join('');

    // Scope filters
    const scopeContainer = document.getElementById('filters-scope');
    scopeContainer.innerHTML = `
        <div class="filter-tag active" data-type="scope" data-value="all">All</div>
        <div class="filter-tag" data-type="scope" data-value="regional">Regional</div>
        <div class="filter-tag" data-type="scope" data-value="national">National</div>
    `;

    // Add click handlers
    document.querySelectorAll('.filter-tag').forEach(tag => {
        tag.onclick = () => {
            const type = tag.dataset.type;
            document.querySelectorAll(`.filter-tag[data-type="${type}"]`).forEach(t => t.classList.remove('active'));
            tag.classList.add('active');
            applyFilters();
        };
    });
}

function applyFilters() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const companyFilter = document.querySelector('.filter-tag[data-type="company"].active')?.dataset.value || 'all';
    const regionFilter = document.querySelector('.filter-tag[data-type="region"].active')?.dataset.value || 'all';
    const cityFilter = document.querySelector('.filter-tag[data-type="city"].active')?.dataset.value || 'all';
    const scopeFilter = document.querySelector('.filter-tag[data-type="scope"].active')?.dataset.value || 'all';
    
    let filtered = contacts;
    
    // Apply filters
    if (companyFilter !== 'all') {
        filtered = filtered.filter(c => c.company === companyFilter);
    }
    if (regionFilter !== 'all') {
        filtered = filtered.filter(c => c.region === regionFilter);
    }
    if (cityFilter !== 'all') {
        filtered = filtered.filter(c => c.city === cityFilter);
    }
    if (scopeFilter === 'regional') {
        filtered = filtered.filter(c => c.scopeRegional);
    } else if (scopeFilter === 'national') {
        filtered = filtered.filter(c => c.scopeNational);
    }
    
    // Apply search
    if (searchTerm) {
        filtered = filtered.filter(c =>
            (c.firstName || '').toLowerCase().includes(searchTerm) ||
            (c.lastName || '').toLowerCase().includes(searchTerm) ||
            (c.company || '').toLowerCase().includes(searchTerm) ||
            (c.city || '').toLowerCase().includes(searchTerm)
        );
    }
    
    displayContacts(filtered);
    updateMap(filtered);
}

function displayContacts(contactList) {
    const container = document.getElementById('contacts-scroll');
    
    const withLocation = contactList.filter(c => c.lat && c.lon);
    const noLocation = contactList.filter(c => !c.lat && !c.lon);
    
    let html = '';
    
    // No location section
    if (noLocation.length > 0) {
        html += `
            <div class="no-location-section">
                <div class="no-location-header" onclick="toggleNoLocationList()">
                    <div class="no-location-title">
                        <span>ğŸ‡«ğŸ‡·</span>
                        <span>All France Contacts</span>
                    </div>
                    <div class="no-location-count">${noLocation.length}</div>
                </div>
                <div class="no-location-list" id="no-location-list">
                    ${noLocation.map(c => generateContactCard(c)).join('')}
                </div>
            </div>
        `;
    }
    
    html += withLocation.map(c => generateContactCard(c)).join('');
    
    container.innerHTML = html;
}

function toggleNoLocationList() {
    const list = document.getElementById('no-location-list');
    list.classList.toggle('expanded');
}

function generateContactCard(contact) {
    const color = getCompanyColor(contact.company);
    return `
        <div class="contact-card" onclick="openContactModal('${contact.id}')">
            <div class="contact-name">
                ${contact.company ? `<span class="company-dot" style="background:${color}"></span>` : ''}
                ${contact.firstName} ${contact.lastName || ''}
            </div>
            ${contact.company ? `<div class="contact-company">${contact.company}</div>` : ''}
            <div class="contact-location">
                ğŸ“ ${contact.fullName || contact.city || 'No location'}
            </div>
        </div>
    `;
}

function updateMap(contactList) {
    markerClusterGroup.clearLayers();
    
    // Group contacts by location
    const locationGroups = {};
    
    contactList.forEach(contact => {
        if (contact.lat && contact.lon) {
            const key = `${contact.lat.toFixed(4)},${contact.lon.toFixed(4)}`;
            if (!locationGroups[key]) {
                locationGroups[key] = [];
            }
            locationGroups[key].push(contact);
        }
    });
    
    // Create markers
    Object.entries(locationGroups).forEach(([key, contacts]) => {
        const [lat, lon] = key.split(',').map(Number);
        
        // If single contact, use company color
        let markerColor = COLOR_PALETTE[0];
        if (contacts.length === 1 && contacts[0].company) {
            markerColor = getCompanyColor(contacts[0].company);
        }
        
        const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background:${markerColor}" class="custom-marker"></div>`,
            iconSize: [16, 16],
            iconAnchor: [8, 8]
        });
        
        let popupContent = '<div style="max-width:280px;font-family:Outfit,sans-serif;">';
        
        if (contacts.length === 1) {
            const c = contacts[0];
            const color = getCompanyColor(c.company);
            popupContent += `
                <div class="popup-header">
                    <div class="popup-title">${c.firstName} ${c.lastName || ''}</div>
                    ${c.company ? `<div class="popup-company" style="color:${color};font-weight:700;">${c.company}</div>` : ''}
                </div>
                <div class="popup-body">
                    ${c.email ? `<div style="margin-bottom:6px;">ğŸ“§ ${c.email}</div>` : ''}
                    ${c.phone ? `<div style="margin-bottom:6px;">ğŸ“ ${c.phone}</div>` : ''}
                    <div style="margin-top:10px;color:#8B94BC;font-size:0.75rem;">ğŸ“ ${c.fullName || c.city}</div>
                </div>
            `;
        } else {
            popupContent += `
                <div class="popup-header">
                    <div class="popup-title">ğŸ“ ${contacts[0].fullName || contacts[0].city}</div>
                    <div class="popup-company">${contacts.length} contacts</div>
                </div>
                <div class="popup-body">
            `;
            contacts.forEach(c => {
                const color = getCompanyColor(c.company);
                popupContent += `
                    <div class="popup-contact-item" onclick="openContactModal('${c.id}')">
                        <div style="font-weight:700;font-size:0.85rem;margin-bottom:2px;">${c.firstName} ${c.lastName || ''}</div>
                        ${c.company ? `<div style="font-size:0.75rem;color:${color};font-weight:600;">${c.company}</div>` : ''}
                    </div>
                `;
            });
            popupContent += '</div>';
        }
        popupContent += '</div>';
        
        const marker = L.marker([lat, lon], { icon })
            .bindPopup(popupContent);
        
        markerClusterGroup.addLayer(marker);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GEOCODING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function geocode(city) {
    try {
        const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city + ', France')}&format=json&limit=1`;
        const response = await fetch(url);
        const data = await response.json();
        if (data && data.length > 0) {
            return {
                lat: parseFloat(data[0].lat),
                lon: parseFloat(data[0].lon),
                fullName: data[0].display_name
            };
        }
    } catch (err) {
        console.error('Geocoding error:', err);
    }
    return null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SERVER SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadFromServer() {
    const stored = localStorage.getItem('azimut_contacts');
    if (stored) {
        contacts = JSON.parse(stored);
    }
}

async function saveToServer() {
    localStorage.setItem('azimut_contacts', JSON.stringify(contacts));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT EXCEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportExcel() {
    const data = contacts.map(c => ({
        'First Name': c.firstName || '',
        'Last Name': c.lastName || '',
        'Company': c.company || '',
        'Email': c.email || '',
        'Phone': c.phone || '',
        'City': c.city || '',
        'Region': c.region || '',
        'Departments': c.deliveryZones?.departments?.join(', ') || '',
        'Delivery Regions': c.deliveryZones?.regions?.join(', ') || '',
        'Regional Scope': c.scopeRegional ? 'Yes' : 'No',
        'National Scope': c.scopeNational ? 'Yes' : 'No'
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Contacts');
    XLSX.writeFile(wb, `contacts_azimut_${new Date().toISOString().split('T')[0]}.xlsx`);
    toast('ğŸ“¤ Export successful');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMPORT EXCEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseScope(s) {
    if (!s) return { scopeRegional: false, scopeNational: false };
    const l = s.toString().toLowerCase();
    return {
        scopeRegional: l.includes('rÃ©gional') || l.includes('regional'),
        scopeNational: l.includes('national')
    };
}

function showImportProgress(msg, current, total) {
    let el = document.getElementById('import-progress-container');
    if (!el) {
        el = document.createElement('div');
        el.id = 'import-progress-container';
        el.style.cssText = 'position:fixed;inset:0;background:rgba(10,14,39,0.9);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);';
        el.innerHTML = `
            <div style="background:var(--sidebar-bg);border:2px solid var(--border);border-radius:20px;padding:40px;min-width:420px;text-align:center;">
                <div style="font-size:1.2rem;font-weight:800;color:var(--text);margin-bottom:8px;font-family:'Space Mono',monospace;" id="imp-msg"></div>
                <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:20px;font-weight:600;" id="imp-count"></div>
                <div style="background:var(--border);border-radius:999px;height:10px;overflow:hidden;">
                    <div id="imp-bar" style="background:linear-gradient(90deg,var(--primary),var(--accent));height:100%;width:0%;transition:width 0.3s ease;border-radius:999px;"></div>
                </div>
            </div>`;
        document.body.appendChild(el);
    }
    const pct = total > 0 ? Math.round((current / total) * 100) : 0;
    document.getElementById('imp-bar').style.width = pct + '%';
    document.getElementById('imp-msg').textContent = msg;
    document.getElementById('imp-count').textContent = `${current} / ${total}`;
}

function hideImportProgress() {
    const el = document.getElementById('import-progress-container');
    if (el) el.remove();
}

function showImportChoiceDialog(existingCount, newCount) {
    return new Promise(resolve => {
        const ov = document.createElement('div');
        ov.style.cssText = 'position:fixed;inset:0;background:rgba(10,14,39,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);';
        ov.innerHTML = `
            <div style="background:var(--sidebar-bg);border:2px solid var(--border);border-radius:24px;padding:40px;max-width:460px;width:90%;font-family:'Outfit',sans-serif;">
                <div style="font-size:2rem;margin-bottom:12px;">ğŸ“‚</div>
                <div style="font-size:1.3rem;font-weight:800;color:var(--text);margin-bottom:12px;">Import Excel</div>
                <p style="color:var(--text-muted);font-size:0.9rem;margin:0 0 24px;line-height:1.6;">
                    Current database: <strong style="color:var(--text)">${existingCount} contact(s)</strong><br>
                    Import file: <strong style="color:var(--text)">${newCount} row(s)</strong><br>
                    What would you like to do?
                </p>
                <div style="display:flex;flex-direction:column;gap:10px;">
                    <button id="bi-replace" style="background:linear-gradient(135deg,#7f1d1d,#991b1b);color:#fff;border:none;border-radius:12px;padding:16px 20px;cursor:pointer;font-size:0.9rem;font-weight:700;text-align:left;font-family:'Outfit',sans-serif;">
                        ğŸ—‘ï¸ Replace â€” Delete old and import
                    </button>
                    <button id="bi-merge" style="background:linear-gradient(135deg,var(--secondary),var(--primary));color:#fff;border:none;border-radius:12px;padding:16px 20px;cursor:pointer;font-size:0.9rem;font-weight:700;text-align:left;font-family:'Outfit',sans-serif;">
                        ğŸ”„ Merge â€” Update existing + add new
                    </button>
                    <button id="bi-cancel" style="background:transparent;color:var(--text-muted);border:2px solid var(--border);border-radius:12px;padding:14px 20px;cursor:pointer;font-size:0.85rem;font-family:'Outfit',sans-serif;font-weight:600;">
                        Cancel
                    </button>
                </div>
            </div>`;
        document.body.appendChild(ov);
        ov.querySelector('#bi-replace').onclick = () => { ov.remove(); resolve('replace'); };
        ov.querySelector('#bi-merge').onclick = () => { ov.remove(); resolve('merge'); };
        ov.querySelector('#bi-cancel').onclick = () => { ov.remove(); resolve(null); };
    });
}

async function importExcel(input) {
    const file = input.files[0];
    if (!file) return;
    input.value = '';

    const reader = new FileReader();
    reader.onload = async (e) => {
        try {
            const wb = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
            const contactCols = ['city', 'first_name', 'ville', 'prenom'];
            let sheetName = wb.SheetNames[0];
            for (const name of wb.SheetNames) {
                const rows0 = XLSX.utils.sheet_to_json(wb.Sheets[name], { header: 1 });
                if (rows0.length > 0) {
                    const headers = (rows0[0] || []).map(h => String(h || '').toLowerCase().trim());
                    if (contactCols.some(c => headers.includes(c))) { sheetName = name; break; }
                }
            }

            const rows = XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);
            if (!rows.length) { toast('Empty file or incorrect format', 'error'); return; }

            let mergeMode = 'replace';
            if (contacts.length > 0) {
                const choice = await showImportChoiceDialog(contacts.length, rows.length);
                if (choice === null) return;
                mergeMode = choice;
            }

            let added = 0, updated = 0, skipped = 0;
            if (mergeMode === 'replace') contacts = [];

            showImportProgress('Starting...', 0, rows.length);

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const city = (row.city || row.City || row.Ville || '').toString().trim();
                const firstName = (row.first_name || row['First Name'] || row.Prenom || '').toString().trim();
                const lastName = (row.last_name || row['Last Name'] || row.Nom || '').toString().trim();
                const company = (row.Company || row.company || row.Entreprise || '').toString().trim();
                const email = (row.email || row.Email || '').toString().trim();
                const phone = (row.phone || row.Phone || row.Telephone || '').toString().trim();
                const regionFF = (row.Region || row.region || '').toString().trim();
                const { scopeRegional, scopeNational } = parseScope(row.Scope || row.scope || '');

                if (!firstName && !city) { skipped++; showImportProgress('Importing...', i + 1, rows.length); continue; }

                showImportProgress(`ğŸ“ ${city || firstName}...`, i + 1, rows.length);

                let lat = null, lon = null, fullName = '', region = regionFF;
                if (city) {
                    const coords = await geocode(city);
                    if (coords) {
                        lat = coords.lat;
                        lon = coords.lon;
                        fullName = coords.fullName;
                        await new Promise(r => setTimeout(r, 1100));
                    }
                }

                const nc = {
                    firstName, lastName, email, phone, city, region, company,
                    scopeRegional, scopeNational, lat, lon, fullName,
                    deliveryZones: { departments: [], regions: [] }
                };

                if (mergeMode === 'merge') {
                    const idx = contacts.findIndex(c =>
                        c.firstName.toLowerCase() === firstName.toLowerCase() &&
                        (c.lastName || '').toLowerCase() === lastName.toLowerCase() &&
                        (c.city || '').toLowerCase() === city.toLowerCase()
                    );
                    if (idx >= 0) { contacts[idx] = { ...contacts[idx], ...nc }; updated++; }
                    else { contacts.push({ id: Date.now().toString() + Math.random(), ...nc }); added++; }
                } else {
                    contacts.push({ id: Date.now().toString() + Math.random(), ...nc }); added++;
                }
            }

            showImportProgress('Saving...', rows.length, rows.length);
            await saveToServer();
            hideImportProgress();
            refreshUI();

            const parts = [`${added} added`];
            if (updated) parts.push(`${updated} updated`);
            if (skipped) parts.push(`${skipped} skipped`);
            toast(`âœ… Import: ${parts.join(' Â· ')}`);

        } catch (err) {
            hideImportProgress();
            toast('Import error: ' + err.message, 'error');
            console.error(err);
        }
    };
    reader.readAsArrayBuffer(file);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 400);
    }, 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BACK TO TOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function scrollToTop() {
    document.getElementById('sidebar').scrollTo({ top: 0, behavior: 'smooth' });
    document.getElementById('contacts-scroll').scrollTo({ top: 0, behavior: 'smooth' });
}

function initBackToTopBtn() {
    const btn = document.getElementById('back-top-btn');
    const checkScroll = () => {
        const sb = document.getElementById('sidebar').scrollTop;
        const cs = document.getElementById('contacts-scroll').scrollTop;
        btn.classList.toggle('visible', sb > 150 || cs > 150);
    };
    document.getElementById('sidebar').addEventListener('scroll', checkScroll);
    document.getElementById('contacts-scroll').addEventListener('scroll', checkScroll);
}
</script>
</body>
</html>
